<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ã‚¹ãƒ­ãƒƒãƒˆã‚²ãƒ¼ãƒ </title>
  <style>
    body {
      font-family: sans-serif;
      background: #f0f0f0;
      text-align: center;
      padding: 2em;
    }
    h1 {
      color: #444;
    }
    #slotArea {
      margin: 2em auto;
      padding: 1em;
      background: white;
      border-radius: 8px;
      width: 300px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    button {
      margin: 0.5em;
      padding: 0.7em 1.2em;
      font-size: 1em;
    }
    #status {
      margin-top: 1em;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>ğŸ° ã‚¹ãƒ­ãƒƒãƒˆã‚²ãƒ¼ãƒ </h1>

  <div id="slotArea">
    <p>æ‰€æŒã‚³ã‚¤ãƒ³: <span id="coinCount">-</span> Spt</p>
    <button id="startBtn">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
    <button id="cashoutBtn">æ¸…ç®—</button>
    <div id="status"></div>
  </div>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const sessionId = urlParams.get('session');
    const coinCountSpan = document.getElementById('coinCount');
    const statusDiv = document.getElementById('status');

    let coins = 0;

    // ã‚»ãƒƒã‚·ãƒ§ãƒ³æƒ…å ±å–å¾—
    async function fetchSession() {
      if (!sessionId) {
        statusDiv.textContent = "âŒ ã‚»ãƒƒã‚·ãƒ§ãƒ³IDãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“";
        return;
      }

      try {
        const res = await fetch(`/api/session?session=${sessionId}`);
        const data = await res.json();

        if (data.error) {
          statusDiv.textContent = `âŒ ${data.error}`;
        } else {
          coins = data.coins;
          coinCountSpan.textContent = coins;
        }
      } catch (e) {
        statusDiv.textContent = "âŒ ã‚»ãƒƒã‚·ãƒ§ãƒ³å–å¾—ã‚¨ãƒ©ãƒ¼";
      }
    }

    document.getElementById('startBtn').addEventListener('click', () => {
      alert("ğŸ° ã‚¹ãƒ­ãƒƒãƒˆã‚’å›ã—ãŸï¼ï¼ˆä»®ï¼‰");
      // å®Ÿè£…æ¬¡ç¬¬ã§ã“ã“ã§ã‚³ã‚¤ãƒ³ã‚’æ¸›ã‚‰ã™ã“ã¨ã‚‚å¯èƒ½
    });

    document.getElementById('cashoutBtn').addEventListener('click', async () => {
      if (!sessionId) {
        alert("âŒ ã‚»ãƒƒã‚·ãƒ§ãƒ³IDãŒã‚ã‚Šã¾ã›ã‚“");
        return;
      }

      try {
        const res = await fetch('/api/cashout', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            session: sessionId,
            coins: coins
          })
        });

        const data = await res.json();

        if (data.status === "ok") {
          statusDiv.textContent = `âœ… æ¸…ç®—ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ã¾ã—ãŸ`;
        } else {
          statusDiv.textContent = `âŒ æ¸…ç®—å¤±æ•—: ${data.error}`;
        }
      } catch (e) {
        statusDiv.textContent = "âŒ æ¸…ç®—ä¸­ã«é€šä¿¡ã‚¨ãƒ©ãƒ¼";
      }
    });

    fetchSession();
  </script>
</body>
</html>
